<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuitarTab Pro - Modernes Design</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
    :root {
        --lichess-dark: #1f1f1f;
        --lichess-card: #2f2f2f;
        --lichess-green: #759656;
        --lichess-light: #ffffff;
        --lichess-gray: #7a7a7a;
        --lichess-accent: #3893E8;
        --lichess-error: #d13438;
        --lichess-success: #107c10;
        --border-radius-lg: 12px;
        --border-radius-md: 8px;
        --border-radius-sm: 6px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Segoe UI', 'Segoe UI Web (West European)', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif;
        background-color: var(--lichess-dark);
        color: var(--lichess-light);
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
    }

    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    /* Header im Lichess-Stil */
    header {
        background: var(--lichess-card);
        color: white;
        padding: 25px;
        margin: 0 0 20px;
        border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        position: relative;
        overflow: hidden;
        z-index: 10;
        box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 15px;
        justify-content: center;
    }

    .logo h1 {
        font-size: 2.2rem;
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .logo i {
        font-size: 2rem;
        background: rgba(255, 255, 255, 0.1);
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Karten-Design mit erhöhtem Border Radius */
    .card {
        background: var(--lichess-card);
        border-radius: var(--border-radius-lg);
        padding: 25px;
        margin-bottom: 0;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .card-header {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--lichess-gray);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .card-header h2 {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--lichess-light);
        position: relative;
    }

    /* Suchbereich mit erhöhtem Border Radius */
    .search-container {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        position: relative;
    }

    .search-input {
        flex: 1;
        min-width: 200px;
        padding: 18px;
        border: 1px solid var(--lichess-gray);
        border-radius: var(--border-radius-md);
        font-size: 1.1rem;
        transition: var(--transition);
        background: rgba(255, 255, 255, 0.08);
        color: var(--lichess-light);
    }

    .search-input:focus {
        border-color: var(--lichess-green);
        outline: none;
        box-shadow: 0 0 0 3px rgba(117, 150, 86, 0.3);
    }

    .search-btn {
        padding: 18px 30px;
        background: var(--lichess-green);
        color: white;
        border: none;
        border-radius: var(--border-radius-md);
        font-size: 1.2rem;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 12px;
        font-weight: 600;
    }

    .search-btn:hover {
        background: #678a4a;
        transform: translateY(-3px);
    }

    .search-btn i {
        font-size: 1.5rem;
    }

    /* Suchergebnisse im Lichess-Stil */
    .suggestions-container {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: var(--lichess-card);
        border: 1px solid var(--lichess-gray);
        border-radius: var(--border-radius-md);
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        z-index: 100;
        max-height: 300px;
        overflow-y: auto;
        display: none;
        margin-top: 5px;
    }

    .suggestion-item {
        padding: 12px 18px;
        border-bottom: 1px solid var(--lichess-gray);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .suggestion-item:hover {
        background: var(--lichess-green);
    }

    .suggestion-artist {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    /* Song-Anzeige */
    .song-display {
        background: rgba(0, 0, 0, 0.2);
        border-radius: var(--border-radius-md);
        padding: 25px;
        margin-top: 15px;
        max-height: 500px;
        overflow-y: auto;
        position: relative;
        border: 1px solid var(--lichess-gray);
    }

    .song-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--lichess-green);
        margin-bottom: 8px;
    }

    .song-artist {
        font-size: 1.3rem;
        color: var(--lichess-light);
        margin-bottom: 20px;
        font-style: italic;
    }

    .chord-line {
        color: var(--lichess-accent);
        font-weight: bold;
        font-size: 1.2rem;
        line-height: 1.6;
        letter-spacing: 1px;
        margin-bottom: 5px;
        white-space: pre-wrap;
        font-family: monospace;
    }

    .lyrics-line {
        font-size: 1.1rem;
        line-height: 1.7;
        margin-bottom: 15px;
        padding-left: 10px;
    }

    .section-title {
        display: block;
        color: var(--lichess-green);
        font-weight: bold;
        margin: 25px 0 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--lichess-gray);
        font-size: 1.3rem;
    }

    /* Steuerelemente */
    .controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 15px;
        margin-top: 25px;
    }

    .control-btn {
        padding: 20px 15px;
        border: none;
        border-radius: var(--border-radius-md);
        font-size: 1.2rem;
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        font-weight: 600;
        background: rgba(255, 255, 255, 0.1);
        color: var(--lichess-light);
    }

    .control-btn:hover {
        transform: translateY(-3px);
        background: rgba(255, 255, 255, 0.2);
    }

    .btn-primary {
        background: var(--lichess-green);
        color: white;
    }

    .btn-primary:hover {
        background: #678a4a;
    }

    .btn-success {
        background: var(--lichess-success);
        color: white;
    }

    .btn-success:hover {
        background: #0d6910;
    }

    /* Geschwindigkeitsregler */
    .speed-control {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-top: 20px;
        padding: 12px;
        background: rgba(117, 150, 86, 0.1);
        border-radius: var(--border-radius-md);
    }

    .speed-control label {
        font-size: 1.1rem;
        white-space: nowrap;
        color: var(--lichess-light);
    }

    .speed-control input {
        flex: 1;
        height: 10px;
        border-radius: 10px;
        background: var(--lichess-gray);
        outline: none;
        -webkit-appearance: none;
    }

    .speed-control input::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: var(--lichess-green);
        cursor: pointer;
    }

    #speedValue {
        min-width: 45px;
        text-align: center;
        font-weight: bold;
        font-size: 1.1rem;
        color: var(--lichess-green);
    }

    /* Benachrichtigungen */
    .notification {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--lichess-card);
        color: white;
        padding: 20px 40px;
        border-radius: var(--border-radius-md);
        display: none;
        z-index: 1001;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        font-size: 1.2rem;
        font-weight: 600;
        border: 1px solid var(--lichess-gray);
    }

    /* Ladeindikator */
    .spinner {
        border: 4px solid rgba(255, 255, 255, 0.1);
        border-top: 4px solid var(--lichess-green);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 30px auto;
        display: none;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .logo h1 {
            font-size: 1.8rem;
        }
        
        .logo i {
            width: 50px;
            height: 50px;
            font-size: 1.6rem;
        }
        
        .card {
            padding: 20px;
        }
        
        .song-display {
            max-height: 400px;
            padding: 20px;
        }
        
        .card-header h2 {
            font-size: 1.6rem;
        }
        
        .control-btn {
            padding: 18px;
            font-size: 1.1rem;
        }
        
        .search-input {
            min-width: 100%;
        }

        .controls {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 480px) {
        .container {
            padding: 15px;
        }
        
        .control-btn {
            padding: 16px;
            font-size: 1rem;
        }
        
        .song-title {
            font-size: 1.5rem;
        }
        
        .song-artist {
            font-size: 1.1rem;
        }
        
        .chord-line {
            font-size: 1rem;
        }
        
        .lyrics-line {
            font-size: 0.95rem;
        }
    }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-guitar"></i>
            <h1>GuitarTab Pro</h1>
        </div>
        <p style="text-align: center; margin-top: 15px; font-size: 1.1rem; opacity: 0.8;">
            Finde Gitarrenakkorde für deine Lieblingssongs - Modernes Design
        </p>
    </header> 

    <div class="container">
        <div class="card">
            <div class="card-header">
                <h2>Online Songsuche</h2>
                <div class="status-indicator" id="status-indicator">
                    <span>Bereit</span>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" id="songInput" class="search-input" placeholder="Songtitel und Künstler (z.B. Let It Be Beatles)">
                <button id="searchButton" class="search-btn">
                    <i class="fas fa-search"></i> Suchen
                </button>
                <div class="suggestions-container" id="suggestionsContainer"></div>
            </div>
            
            <div class="spinner" id="loadingSpinner"></div>
            
            <div class="song-display" id="song-display">
                <div style="text-align: center; padding: 40px; color: var(--lichess-gray);">
                    <i class="fas fa-music" style="font-size: 4rem; margin-bottom: 20px; opacity: 0.3;"></i>
                    <h3>Gib einen Songtitel und Künstler ein</h3>
                    <p>Deine Akkorde werden hier angezeigt</p>
                </div>
            </div>
            
            <div class="speed-control">
                <label for="scrollSpeed">Scroll-Geschwindigkeit:</label>
                <input type="range" id="scrollSpeed" min="1" max="10" value="3">
                <span id="speedValue">3 W/s</span>
            </div>
            
            <div class="controls">
                <button id="scrollToggle" class="control-btn btn-primary">
                    <i class="fas fa-play"></i> Auto-Scroll Start
                </button>
                <button id="saveButton" class="control-btn btn-success">
                    <i class="fas fa-download"></i> Offline speichern
                </button>
                <button id="transposeUp" class="control-btn">
                    <i class="fas fa-arrow-up"></i> Transponieren (+)
                </button>
                <button id="transposeDown" class="control-btn">
                    <i class="fas fa-arrow-down"></i> Transponieren (-)
                </button>
                <button id="copyBtn" class="control-btn">
                    <i class="fas fa-copy"></i> Akkorde kopieren
                </button>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // App State
        let currentSongData = null;
        let autoScrollInterval = null;
        let currentScrollSpeed = 3; // Wörter pro Sekunde
        let scrollPosition = 0;
        let transposition = 0;
        let songLines = [];
        let currentLineIndex = 0;
        let lastUpdateTime = 0;

        // DOM Elements
        const songInput = document.getElementById('songInput');
        const searchButton = document.getElementById('searchButton');
        const songDisplay = document.getElementById('song-display');
        const scrollToggle = document.getElementById('scrollToggle');
        const saveButton = document.getElementById('saveButton');
        const transposeUp = document.getElementById('transposeUp');
        const transposeDown = document.getElementById('transposeDown');
        const copyBtn = document.getElementById('copyBtn');
        const scrollSpeed = document.getElementById('scrollSpeed');
        const speedValue = document.getElementById('speedValue');
        const notification = document.getElementById('notification');
        const statusIndicator = document.getElementById('status-indicator');
        const suggestionsContainer = document.getElementById('suggestionsContainer');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Proxy für API-Zugriffe
        const PROXY_URL = 'https://corsproxy.io/?';

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Event Listeners
            searchButton.addEventListener('click', searchSong);
            scrollToggle.addEventListener('click', toggleAutoScroll);
            saveButton.addEventListener('click', saveOffline);
            transposeUp.addEventListener('click', () => transposeChords(1));
            transposeDown.addEventListener('click', () => transposeChords(-1));
            copyBtn.addEventListener('click', copyChords);
            scrollSpeed.addEventListener('input', updateScrollSpeed);
            
            // Search suggestions
            songInput.addEventListener('input', showSuggestions);
            
            // Set initial scroll speed
            updateScrollSpeed();
        });

        // Show search suggestions
        function showSuggestions() {
            const query = songInput.value.trim().toLowerCase();
            
            suggestionsContainer.innerHTML = '';
            
            if (!query) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Populäre Vorschläge
            const popularSongs = [
                "Let It Be Beatles",
                "Hotel California Eagles",
                "Wonderwall Oasis",
                "Stairway to Heaven Led Zeppelin",
                "Sweet Child O' Mine Guns N' Roses",
                "Smells Like Teen Spirit Nirvana",
                "Hey Jude Beatles",
                "Wish You Were Here Pink Floyd",
                "Knockin' on Heaven's Door Bob Dylan",
                "Tears in Heaven Eric Clapton"
            ];
            
            const filteredSongs = popularSongs.filter(song => 
                song.toLowerCase().includes(query)
            ).slice(0, 5);
            
            if (filteredSongs.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            filteredSongs.forEach(song => {
                const suggestionItem = document.createElement('div');
                suggestionItem.className = 'suggestion-item';
                suggestionItem.textContent = song;
                
                suggestionItem.addEventListener('click', () => {
                    songInput.value = song;
                    suggestionsContainer.style.display = 'none';
                    searchSong();
                });
                
                suggestionsContainer.appendChild(suggestionItem);
            });
            
            suggestionsContainer.style.display = 'block';
        }

        // Search for a song online
        async function searchSong() {
            const query = songInput.value.trim();
            
            if (!query) {
                showNotification("Bitte einen Songtitel und Künstler eingeben", "error");
                return;
            }
            
            showNotification("Suche Akkorde online...", "info");
            statusIndicator.innerHTML = '<span style="color: var(--lichess-green);">Suche Akkorde...</span>';
            loadingSpinner.style.display = 'block';
            songDisplay.innerHTML = '';
            
            try {
                const songData = await fetchSongData(query);
                currentSongData = songData;
                displaySong(songData);
                showNotification("Akkorde geladen!", "success");
                statusIndicator.innerHTML = '<span style="color: var(--lichess-green);">Akkorde geladen</span>';
            } catch (error) {
                console.error(error);
                showNotification("Fehler beim Laden des Songs. Bitte versuche einen anderen Songtitel.", "error");
                statusIndicator.innerHTML = '<span style="color: var(--lichess-error);">Fehler beim Laden</span>';
                songDisplay.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--lichess-gray);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; margin-bottom: 20px; color: var(--lichess-error);"></i>
                        <h3>Fehler beim Laden des Songs</h3>
                        <p>Bitte versuche einen anderen Songtitel</p>
                    </div>
                `;
            } finally {
                loadingSpinner.style.display = 'none';
                suggestionsContainer.style.display = 'none';
            }
        }

        // Fetch song data from Ultimate Guitar API using proxy
        async function fetchSongData(query) {
            // In einer echten Implementierung würde dies die Ultimate Guitar API über einen Proxy aufrufen
            // Für dieses Beispiel verwenden wir simulierte Daten
            
            return new Promise((resolve) => {
                setTimeout(() => {
                    // Simulierte API-Antwort
                    resolve({
                        title: query.split(' ').slice(0, -1).join(' ') || "Unbekannter Song",
                        artist: query.split(' ').pop() || "Unbekannter Künstler",
                        content: `
[Intro]
[ch]C[/ch] [ch]G[/ch] [ch]Am[/ch] [ch]F[/ch] [ch]C[/ch] [ch]G[/ch] [ch]F[/ch] [ch]C[/ch]

[Verse 1]
[ch]C[/ch]When I find myself in times of trouble
[ch]G[/ch]Mother Mary comes to me
[ch]Am[/ch]Speaking words of wisdom
[ch]F[/ch] [ch]C[/ch] [ch]G[/ch] [ch]F[/ch] [ch]C[/ch]Let it be

[Verse 2]
[ch]C[/ch]And in my hour of darkness
[ch]G[/ch]She is standing right in front of me
[ch]Am[/ch]Speaking words of wisdom
[ch]F[/ch] [ch]C[/ch] [ch]G[/ch] [ch]F[/ch] [ch]C[/ch]Let it be

[Chorus]
[ch]Am[/ch]Let it be, [ch]G[/ch]let it be
[ch]F[/ch]Let it be, [ch]C[/ch]let it be
[ch]G[/ch]Whisper words of wisdom
[ch]F[/ch] [ch]C[/ch] [ch]G[/ch] [ch]F[/ch] [ch]C[/ch]Let it be`
                    });
                }, 1500);
            });
        }

        // Display song with chords above lyrics
        function displaySong(songData) {
            let html = `
                <div class="song-title">${songData.title}</div>
                <div class="song-artist">${songData.artist}</div>
            `;
            
            const sections = songData.content.trim().split('\n\n');
            songLines = [];
            
            sections.forEach(section => {
                const lines = section.split('\n');
                const sectionTitleMatch = lines[0].match(/^\[(.*)\]$/);
                
                if (sectionTitleMatch) {
                    html += `<div class="section-title">${sectionTitleMatch[1]}</div>`;
                }
                
                let chordLine = '';
                let lyricLine = '';
                
                for (let i = sectionTitleMatch ? 1 : 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // Process chord lines
                    if (line.includes('[ch]')) {
                        chordLine = '<div class="chord-line">';
                        const chords = line.match(/\[ch\](.*?)\[\/ch\]/g) || [];
                        
                        chords.forEach(chord => {
                            const chordName = chord.replace(/\[ch\]|\[\/ch\]/g, '');
                            chordLine += `<span class="chord">${chordName}</span> `;
                        });
                        
                        chordLine += '</div>';
                    } else {
                        // Process lyric lines
                        lyricLine = `<div class="lyrics-line">${line}</div>`;
                        
                        // Only add if we have chords to display above
                        if (chordLine) {
                            html += chordLine + lyricLine;
                            songLines.push(chordLine);
                            songLines.push(lyricLine);
                            chordLine = '';
                        } else {
                            html += lyricLine;
                            songLines.push(lyricLine);
                        }
                    }
                }
                
                // Add remaining chords if any
                if (chordLine) {
                    html += chordLine;
                    songLines.push(chordLine);
                }
            });
            
            songDisplay.innerHTML = html;
            
            // Reset scroll position
            songDisplay.scrollTop = 0;
            scrollPosition = 0;
            currentLineIndex = 0;
            lastUpdateTime = 0;
            
            // Reset transposition
            transposition = 0;
        }

        // Toggle auto scroll
        function toggleAutoScroll() {
            if (autoScrollInterval) {
                cancelAnimationFrame(autoScrollInterval);
                autoScrollInterval = null;
                scrollToggle.innerHTML = '<i class="fas fa-play"></i> Auto-Scroll Start';
                scrollToggle.classList.remove('btn-success');
                scrollToggle.classList.add('btn-primary');
            } else {
                startAutoScroll();
                scrollToggle.innerHTML = '<i class="fas fa-stop"></i> Auto-Scroll Stop';
                scrollToggle.classList.remove('btn-primary');
                scrollToggle.classList.add('btn-success');
            }
        }

        // Start auto scroll with word-based speed
        function startAutoScroll() {
            if (autoScrollInterval) cancelAnimationFrame(autoScrollInterval);
            
            const startTime = performance.now();
            lastUpdateTime = startTime;
            
            function scrollStep(timestamp) {
                if (!lastUpdateTime) lastUpdateTime = timestamp;
                
                const elapsed = timestamp - lastUpdateTime;
                const wordsPerSecond = currentScrollSpeed;
                const wordsPerMillisecond = wordsPerSecond / 1000;
                const wordsScrolled = elapsed * wordsPerMillisecond;
                
                // Move to the next line based on word count
                if (currentLineIndex < songLines.length) {
                    const line = songLines[currentLineIndex];
                    const wordCount = line.split(/\s+/).filter(word => word.length > 0).length;
                    
                    if (wordsScrolled >= wordCount) {
                        // Move to next line
                        currentLineIndex++;
                        lastUpdateTime = timestamp;
                        
                        // Calculate new scroll position
                        if (currentLineIndex > 0) {
                            const lineElements = songDisplay.querySelectorAll('.chord-line, .lyrics-line, .section-title');
                            if (lineElements[currentLineIndex]) {
                                scrollPosition = lineElements[currentLineIndex].offsetTop;
                                songDisplay.scrollTop = scrollPosition;
                            }
                        }
                    }
                } else {
                    // Reached the end, reset
                    currentLineIndex = 0;
                    scrollPosition = 0;
                    songDisplay.scrollTop = 0;
                    lastUpdateTime = timestamp;
                }
                
                if (autoScrollInterval) {
                    autoScrollInterval = requestAnimationFrame(scrollStep);
                }
            }
            
            autoScrollInterval = requestAnimationFrame(scrollStep);
        }

        // Update scroll speed
        function updateScrollSpeed() {
            currentScrollSpeed = parseInt(scrollSpeed.value);
            speedValue.textContent = `${currentScrollSpeed} W/s`;
        }

        // Transpose chords
        function transposeChords(steps) {
            if (!currentSongData) return;
            
            transposition += steps;
            const chords = document.querySelectorAll('.chord');
            
            chords.forEach(chord => {
                chord.textContent = transposeChord(chord.textContent, steps);
            });
            
            showNotification(`Um ${steps} Halbtöne transponiert`, "info");
        }

        // Transpose a single chord
        function transposeChord(chord, steps) {
            const chordMap = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            const baseChord = chord.replace(/[^A-G#]/g, '');
            const suffix = chord.replace(baseChord, '');
            
            const baseIndex = chordMap.indexOf(baseChord);
            if (baseIndex === -1) return chord;
            
            const newIndex = (baseIndex + steps + 12) % 12;
            return chordMap[newIndex] + suffix;
        }

        // Save song offline
        function saveOffline() {
            if (!currentSongData) {
                showNotification("Kein Song zum Speichern gefunden", "error");
                return;
            }
            
            try {
                let savedSongs = JSON.parse(localStorage.getItem('guitarTabs')) || [];
                
                // Check if song already exists
                const exists = savedSongs.some(song => 
                    song.title === currentSongData.title && 
                    song.artist === currentSongData.artist
                );
                
                if (exists) {
                    showNotification("Song ist bereits offline gespeichert", "info");
                    return;
                }
                
                // Add timestamp
                const songToSave = {
                    ...currentSongData,
                    savedAt: new Date().toISOString(),
                    transposition: transposition
                };
                
                savedSongs.push(songToSave);
                localStorage.setItem('guitarTabs', JSON.stringify(savedSongs));
                
                showNotification("Song offline gespeichert!", "success");
            } catch (e) {
                showNotification("Fehler beim Speichern: " + e.message, "error");
            }
        }

        // Copy chords to clipboard
        function copyChords() {
            if (!currentSongData) {
                showNotification("Keine Akkorde zum Kopieren", "error");
                return;
            }
            
            try {
                // Create a simplified text version
                const chordText = currentSongData.content
                    .replace(/\[ch\](.*?)\[\/ch\]/g, '$1')
                    .replace(/\[.*?\]/g, '');
                
                navigator.clipboard.writeText(chordText)
                    .then(() => {
                        showNotification("Akkorde kopiert!", "success");
                    })
                    .catch(err => {
                        showNotification("Fehler beim Kopieren: " + err, "error");
                    });
            } catch (e) {
                showNotification("Fehler beim Kopieren: " + e.message, "error");
            }
        }

        // Show notification
        function showNotification(message, type = "info") {
            notification.textContent = message;
            notification.style.display = 'block';
            
            switch (type) {
                case "success":
                    notification.style.backgroundColor = "var(--lichess-success)";
                    break;
                case "error":
                    notification.style.backgroundColor = "var(--lichess-error)";
                    break;
                case "info":
                    notification.style.backgroundColor = "var(--lichess-green)";
                    break;
                default:
                    notification.style.backgroundColor = "var(--lichess-card)";
            }
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>